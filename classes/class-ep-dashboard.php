<?php

class EP_Dashboard {

	/**
	 * Placeholder method
	 *
	 * @since 0.1.3
	 */
	public function __construct() { }

	/**
	 * Return singleton instance of class
	 *
	 * @return EP_Dashboard
	 * @since 0.1.3
	 */
	public static function factory() {
		static $instance = false;

		if ( ! $instance  ) {
			$instance = new self();
			add_action( 'init', array( $instance, 'setup' ) );
			
		}

		return $instance;
	}

	public function setup() {
		add_action( 'admin_menu', array( $this, 'action_admin_menu' ) );
	}

	public function action_admin_menu() {
		add_menu_page(
			"ElasticPress",
			"ElasticPress",
			"activate_plugins",
			"elastic-press",
			array( $this, 'dashboard_page' ),
			'data:image/svg+xml;base64,//48AD8AeABtAGwAIAB2AGUAcgBzAGkAbwBuAD0AIgAxAC4AMAAiACAAZQBuAGMAbwBkAGkAbgBnAD0AIgB1AHQAZgAtADEANgAiAD8APgANAAoAPAAhAC0ALQAgAEcAZQBuAGUAcgBhAHQAbwByADoAIABBAGQAbwBiAGUAIABJAGwAbAB1AHMAdAByAGEAdABvAHIAIAAxADQALgAwAC4AMAAsACAAUwBWAEcAIABFAHgAcABvAHIAdAAgAFAAbAB1AGcALQBJAG4AIAAuACAAUwBWAEcAIABWAGUAcgBzAGkAbwBuADoAIAA2AC4AMAAwACAAQgB1AGkAbABkACAANAAzADMANgAzACkAIAAgAC0ALQA+AA0ACgA8ACEARABPAEMAVABZAFAARQAgAHMAdgBnACAAUABVAEIATABJAEMAIAAiAC0ALwAvAFcAMwBDAC8ALwBEAFQARAAgAFMAVgBHACAAMQAuADEALwAvAEUATgAiACAAIgBoAHQAdABwADoALwAvAHcAdwB3AC4AdwAzAC4AbwByAGcALwBHAHIAYQBwAGgAaQBjAHMALwBTAFYARwAvADEALgAxAC8ARABUAEQALwBzAHYAZwAxADEALgBkAHQAZAAiAD4ADQAKADwAcwB2AGcAIAB2AGUAcgBzAGkAbwBuAD0AIgAxAC4AMQAiACAAaQBkAD0AIgBMAGEAeQBlAHIAXwAxACIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AdwB3AHcALgB3ADMALgBvAHIAZwAvADIAMAAwADAALwBzAHYAZwAiACAAeABtAGwAbgBzADoAeABsAGkAbgBrAD0AIgBoAHQAdABwADoALwAvAHcAdwB3AC4AdwAzAC4AbwByAGcALwAxADkAOQA5AC8AeABsAGkAbgBrACIAIAB4AD0AIgAwAHAAeAAiACAAeQA9ACIAMABwAHgAIgANAAoACQAgAHcAaQBkAHQAaAA9ACIANwAwAHAAeAAiACAAaABlAGkAZwBoAHQAPQAiADcAMABwAHgAIgAgAHYAaQBlAHcAQgBvAHgAPQAiADAAIAAwACAANwAwACAANwAwACIAIABlAG4AYQBiAGwAZQAtAGIAYQBjAGsAZwByAG8AdQBuAGQAPQAiAG4AZQB3ACAAMAAgADAAIAA3ADAAIAA3ADAAIgAgAHgAbQBsADoAcwBwAGEAYwBlAD0AIgBwAHIAZQBzAGUAcgB2AGUAIgA+AA0ACgA8AGcAPgANAAoACQA8AHAAYQB0AGgAIABmAGkAbABsAD0AIgBuAG8AbgBlACIAIABkAD0AIgBNADcALgA5ADkAMQAsADIAOAAuADEANAA1AGMAMQAuADIAMQAyACwAMQAuADIAMQAyACwAMwAuADcAMQA2ACwAMQAuADkAMAA5ACwANgAuADMAMgAzACwAMgAuADMAMQBjAC0AMgAuADcAMQAyAC0AMAAuADUAOAAxAC0ANQAuADIANwA4AC0AMQAuADQAMQA1AC0ANgAuADUANgAzAC0AMgAuADYAMAAyAA0ACgAJAAkAQwA3AC4AOAAzADEALAAyADcALgA5ADUAMQAsADcALgA5ADAANgAsADIAOAAuADAANgAsADcALgA5ADkAMQAsADIAOAAuADEANAA1AHoAIgAvAD4ADQAKAAkAPABwAGEAdABoACAAZgBpAGwAbAA9ACIAbgBvAG4AZQAiACAAZAA9ACIATQA1AC4ANAAxACwAMQA3AC4ANQA3ADYAbAAwAC4AMAA0ADQALQAwAC4AOQAwADEAbAAxAC4AMQAwADQALAAwAC4AMQA2ADcAYwAwAC4AOQAyADYALAAwAC4AMQA0ACwANwAuADkAMgAzACwAMQAuADIANQA1ACwAMQAxAC4AOQA2ADUALAAzAC4AMwAyADMADQAKAAkACQBjAC0AMwAuADQAMAAzAC0AMgAuADkAMQA3AC0AMQAzAC4AMwA3ADUALQAzAC4ANwAzADUALQAxADMALgAzADcANQAtADMALgA3ADMANQBzADAALgAwADQANQAsADEALgA0ADQAMQAsADAALgAyADUANgAsADMALgAzADMANABDADUALgAzADYANwAsADEAOAAuADYANQA0ACwANQAuADMAOQA4ACwAMQA3AC4AOAAxADkALAA1AC4ANAAxACwAMQA3AC4ANQA3ADYAegAiAC8APgANAAoACQA8AHAAYQB0AGgAIABmAGkAbABsAD0AIgBuAG8AbgBlACIAIABkAD0AIgBNADYAMwAuADAANgA0ACwANAAyAC4AOQA1ADEAbAAwAC4AOAA5ADUALAAwAC4ANAAzADUAbAAtADAALgA1ADMAOQAsADAALgA4ADIANwBjAC0AMAAuADIAMQA5ACwAMAAuADMAMwA1AC0ANQAuADQAMQA0ACwAOAAuADIANQAzAC0AOQAuADUAMgAxACwAOQAuADUADQAKAAkACQBjADAALgAwADMANAAtADAALgAwADEALAAwAC4AMAA3ADcALQAwAC4AMAAxADIALAAwAC4AMQAxADEALQAwAC4AMAAyADIAYwA0AC4AMwAwADQALQAxAC4AMwAxADkALAAxADAALgAxADIAOAAtADEAMAAuADQAMAA2ACwAMQAwAC4AMQAyADgALQAxADAALgA0ADAANgBzAC0ANQAuADkAMAAzAC0AMgAuADkAMQAyAC0AOQAuADkAMAAyAC0AMwAuADIAMAAzAA0ACgAJAAkAQwA1ADcALgA5ADEANgAsADQAMAAuADQANwAxACwANgAyAC4AOAAzADkALAA0ADIALgA4ADQAMQAsADYAMwAuADAANgA0ACwANAAyAC4AOQA1ADEAegAiAC8APgANAAoACQA8AHAAYQB0AGgAIABmAGkAbABsAD0AIgAjADIAQQA2AEEAMwA1ACIAIABkAD0AIgBNADYANQAuADAAMgA0ACwANAAxAC4ANAA5ADEAYwAtADAALgA3ADEAMwAtADAALgAzADUAMgAtADcALgAwADgAOAAtADMALgA0ADMAOAAtADEAMQAuADQAMAA1AC0AMwAuADQAMwA4AGMALQAwAC4ANwA0ADMALAAwAC0AMQAuADQAMQA3ACwAMAAuADAAOQAxAC0AMgAuADAAMAAyACwAMAAuADIANwAxAA0ACgAJAAkAYwAtADEALgAyADMANAAsADAALgAzADcAOAAtADIALgA0ADcAOAAsADEALgAyADcAOAAtADMALgA2ADYAMgAsADIALgA0ADMAOQBWADEAMAAuADEANQAxAEgAMQA5AC4AOAAxADMAdgA4AC4ANQAwADUAYwAtADMALgA4ADIANQAtADMALgAyADQAOQAtADEAMwAuADMAOAA2AC0ANAAuADEAMgA5AC0AMQA0AC4ANQAtADQALgAyADIAMQBsAC0AMgAuADIAMgA5AC0AMAAuADEAOAAzAGwAMAAuADAANgA2ACwAMgAuADIAMwA1AA0ACgAJAAkAYwAwAC4AMAA0ADkALAAxAC4ANgA1ADkALAAwAC4ANAA0ADQALAAxADAALgAwADgANwAsADMALgA0ADIAOAAsADEAMwAuADAANwAxAGMAMgAuADUAMwA4ACwAMgAuADUAMwA4ACwAOAAuADYAOAAzACwAMwAuADIAMwA5ACwAMQAzAC4AMgAzADUALAAzAC4AMwA5ADQAVgA2ADEAaAAyADgALgAxADQAMwB2AC0ANQAuADQAMQA2AA0ACgAJAAkAYwAxAC4AMgA4ADkALAAwAC4AMgAxADkALAAyAC4ANgAzADEALAAwAC4AMwA3ADUALAAzAC4AOAA1ADUALAAwAC4AMwA3ADUAYwAxAC4AMAA5ACwAMAAsADIALgAwADAAMgAtADAALgAxADEANwAsADIALgA3ADgANgAtADAALgAzADUANwBjADQALgA4ADYANQAtADEALgA0ADkAMQAsADEAMAAuADUAOAA5AC0AMQAwAC4AMgA0ADYALAAxADEALgAyADIANgAtADEAMQAuADIAMwA5AGwAMQAuADIAMAA3AC0AMQAuADgAOAAyAA0ACgAJAAkATAA2ADUALgAwADIANAAsADQAMQAuADQAOQAxAHoAIABNADIAMgAuADkAMwA5ACwAMwAxAC4ANgAzAGMAMAAsADAALQAwAC4AMgA2ADkALQAwAC4AMAAxADcALQAwAC4ANwAzADMALQAwAC4AMAA1ADcAYwAtADEALgA4ADAAOAAtADAALgAxADUAMgAtADQALgA5ADMAMwAtADAALgA0ADgANQAtADcALgA4ADkAMgAtADEALgAxADEAOQANAAoACQAJAGMALQAyAC4ANgAwADcALQAwAC4ANAAwADEALQA1AC4AMQAxADEALQAxAC4AMAA5ADgALQA2AC4AMwAyADMALQAyAC4AMwAxAGMALQAwAC4AMAA4ADUALQAwAC4AMAA4ADQALQAwAC4AMQA2AC0AMAAuADEAOQA0AC0AMAAuADIAMwA5AC0AMAAuADIAOQAyAGMALQAwAC4AMAAxADgALQAwAC4AMAAxADYALQAwAC4AMAAzADkALQAwAC4AMAAyADkALQAwAC4AMAA1ADYALQAwAC4AMAA0ADUADQAKAAkACQBjAC0AMQAuADcAOAAxAC0AMQAuADcAMAA0AC0AMgAuADIAMAA5AC0ANQAuADUANgAzAC0AMgAuADIAOQAyAC0AOAAuADAANAA1AGMALQAwAC4AMgAxADEALQAxAC4AOAA5ADMALQAwAC4AMgA1ADYALQAzAC4AMwAzADQALQAwAC4AMgA1ADYALQAzAC4AMwAzADQAcwA5AC4AOQA3ADIALAAwAC4AOAAxADkALAAxADMALgAzADcANQAsADMALgA3ADMANQANAAoACQAJAGMAMAAuADcAOAA0ACwAMAAuADQAMAAxACwAMQAuADQANgA5ACwAMAAuADgAMwA1ACwAMQAuADkANgA0ACwAMQAuADMAMAA5AGMAMgAuADUANgA4ACwAMgAuADQANQA2ACwAMwAuADQANQAyACwAOQAuADAAMQA3ACwAMwAuADQAOAA4ACwAOQAuADIAOQA0AGwAMAAuADEAMgAzACwAMAAuADkAMwA4AEwAMgAyAC4AOQAzADkALAAzADEALgA2ADMAegAgAE0ANQA0AC4AMAAxADEALAA1ADMALgA2ADkADQAKAAkACQBjAC0AMAAuADAAMwA0ACwAMAAuADAAMQAtADAALgAwADcANwAsADAALgAwADEAMwAtADAALgAxADEAMQAsADAALgAwADIAMgBjAC0AMAAuADAAMAAzACwAMAAuADAAMAAxAC0AMAAuADAAMAA2ACwAMAAuADAAMAAyAC0AMAAuADAAMAA5ACwAMAAuADAAMAAzAGMALQAwAC4ANgAwADYALAAwAC4AMQA4ADMALQAxAC4AMwA1ADQALAAwAC4AMgA3ADUALQAyAC4AMgAyADYALAAwAC4AMgA3ADUADQAKAAkACQBjAC0AMwAuADUANgAyACwAMAAtADgALgAzADMANQAtADEALgA1ADEAMwAtADgALgA1ADMANgAtADEALgA1ADcANwBMADQAMgAuADEANAAzACwANQAyAC4AMQBsADAALgA0ADYANQAtADAALgA5ADEANABjADAALgA1ADAANgAtADAALgA5ADkAMgAsADUALgAwADUAOQAtADkALgA3ADMAMQAsADkALgAxADQANgAtADEAMAAuADkANgA0AA0ACgAJAAkAYwAwAC4ANAAzADgALQAwAC4AMQAzADMALAAwAC4AOQA1ADEALQAwAC4AMQA5ADkALAAxAC4ANQAyADQALQAwAC4AMQA5ADkAYwAwAC4AMwAwADYALAAwACwAMAAuADYAMgA4ACwAMAAuADAAMgA1ACwAMAAuADkANQA4ACwAMAAuADAANgBjADMALgA5ADkAOQAsADAALgAyADkAMQAsADkALgA5ADAAMgAsADMALgAyADAAMwAsADkALgA5ADAAMgAsADMALgAyADAAMwANAAoACQAJAFMANQA4AC4AMwAxADQALAA1ADIALgAzADcAMgAsADUANAAuADAAMQAxACwANQAzAC4ANgA5AHoAIgAvAD4ADQAKADwALwBnAD4ADQAKADwALwBzAHYAZwA+AA0ACgA=',
			"59.9"
		);
	}

	public function dashboard_page() {
		if ( ep_elasticsearch_alive() ) {
			$stats = ep_get_stats();
			$popular_searches = ep_get_frequent_searches();

			// TODO: make pretty
			?>
			<div class="stats">
				<pre><?php echo $stats; ?></pre>
			</div>
			<div class="stats">
				<pre><?php echo json_encode( $popular_searches, JSON_PRETTY_PRINT ); ?></pre>
			</div>
		<?php

		} else {
		?>
			<div class="error">
				<p><?php _e( 'Unable to reach ElasticPress endpoint', 'elastic-press' ); ?></p>
			</div>
		<?php
		}

	}
}

EP_Dashboard::factory();

/**
 * Accessor functions for methods in above class. See doc blocks above for function details.
 */
/*
function ep_index_post( $post ) {
	return EP_Dashboard::factory()->index_post( $post );
}

function ep_search( $args, $cross_site = false ) {
	return EP_Dashboard::factory()->search( $args, $cross_site );
}

*/